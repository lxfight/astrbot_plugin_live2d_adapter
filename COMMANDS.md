# Live2D Adapter 管理命令文档

本文档介绍 Live2D Adapter 插件提供的所有管理命令。

## 命令列表

### 1. 状态查询命令

#### `/live2d.status` (别名: `/l2d.status`)
显示 Live2D 适配器的整体运行状态。

**权限**: 所有用户

**输出信息**:
- 当前连接数和最大连接数
- 当前活动客户端 ID
- 资源使用情况（文件数、存储空间）
- 临时文件使用情况
- WebSocket 服务器状态
- 资源服务器状态
- 功能开关状态（流式消息、TTS）

**示例输出**:
```
📊 Live2D 适配器状态

🔌 连接信息:
  • 当前连接数: 1/1
  • 当前客户端: abc123def456

💾 资源使用:
  • 资源文件: 45/2000 (2.3%)
  • 存储空间: 128.0MB/1.0GB (12.5%)
  • 临时文件: 12/5000
  • 临时空间: 45.0MB/256.0MB

🌐 服务器状态:
  • WebSocket: ✅ 运行中 (0.0.0.0:9090)
  • 资源服务器: ✅ 运行中 (0.0.0.0:9091)
  • 流式消息: ✅ 已启用
  • TTS: ❌ 未启用
```

---

#### `/live2d.info` (别名: `/l2d.info`)
显示当前连接客户端的详细信息。

**权限**: 所有用户

**输出信息**:
- 客户端 ID
- Live2D 模型名称
- 连接时长
- 可用动作组数量和总动作数
- 可用表情数量

**示例输出**:
```
ℹ️ 客户端详细信息

🎭 客户端 ID: abc123def456
📦 模型名称: Hiyori
⏱️ 连接时长: 2小时15分钟
  • 动作组: 8 组，共 45 个动作
  • 表情: 12 个

💡 提示: 使用 /live2d.test_motion <组名> 测试动作
       使用 /live2d.test_expression <表情ID> 测试表情
```

---

#### `/live2d.list` (别名: `/l2d.list`, `/l2d.clients`)
列出所有当前连接的客户端。

**权限**: 所有用户

**输出信息**:
- 客户端 ID（前 8 位）
- 模型名称
- 当前活动客户端标记（✅）

**示例输出**:
```
📋 连接的客户端列表 (2)

✅ abc123de... - Hiyori
   def456ab... - Shizuku
```

---

### 2. 资源管理命令

#### `/live2d.resources` (别名: `/l2d.resources`, `/l2d.res`)
显示资源存储的详细统计信息。

**权限**: 所有用户

**输出信息**:
- 总文件数和总大小
- 按类型分类的资源统计
- 配额使用情况

**示例输出**:
```
📦 资源统计

总计: 45 个文件，128.5MB

按类型:
  • image: 30 个
  • audio: 10 个
  • video: 5 个

配额: 45/2000 文件
     128.5MB/1.0GB 空间
```

---

#### `/live2d.cleanup` (别名: `/l2d.cleanup`)
手动触发资源和临时文件清理。

**权限**: 仅管理员

**功能**:
- 清理过期的资源文件
- 清理过期的临时文件
- 释放存储空间

**示例输出**:
```
🧹 清理完成

  • 清理资源文件: 5 个
  • 清理临时文件: 8 个
```

---

### 3. 配置管理命令

#### `/live2d.config` (别名: `/l2d.config`, `/l2d.cfg`)
显示当前适配器的完整配置信息。

**权限**: 仅管理员

**输出信息**:
- WebSocket 配置（地址、端口、路径、认证）
- 功能开关状态
- 资源管理配置
- 临时文件配置

**示例输出**:
```
⚙️ Live2D 适配器配置

WebSocket:
  • 地址: 0.0.0.0:9090
  • 路径: /astrbot/live2d
  • 认证: 已启用
  • 最大连接: 1

功能:
  • 流式消息: ✅
  • TTS: ❌
  • 资源服务器: ✅

资源管理:
  • 资源目录: live2d_resources
  • 资源 TTL: 7天
  • 最大文件: 2000
  • 最大空间: 1.0GB

临时文件:
  • 临时目录: live2d_temp
  • 临时 TTL: 6小时
  • 最大文件: 5000
```

---

## 使用场景

### 场景 1: 检查适配器是否正常运行
```
用户: /live2d.status
```
查看服务器状态、连接数、资源使用情况。

### 场景 2: 查看当前连接的客户端信息
```
用户: /live2d.info
```
了解客户端模型、连接时长、可用动作和表情。

### 场景 3: 管理多个客户端
```
用户: /live2d.list
```
查看所有连接的客户端，识别当前活动客户端。

### 场景 4: 监控资源使用
```
用户: /live2d.resources
```
检查资源存储情况，确保不超过配额。

### 场景 5: 清理过期资源（管理员）
```
管理员: /live2d.cleanup
```
手动触发清理，释放存储空间。

### 场景 6: 查看配置（管理员）
```
管理员: /live2d.config
```
检查当前配置，确认设置是否正确。

---

## 权限说明

### 普通用户权限
- `/live2d.status` - 查看状态
- `/live2d.info` - 查看客户端信息
- `/live2d.list` - 列出客户端
- `/live2d.resources` - 查看资源统计

### 管理员权限
- `/live2d.cleanup` - 手动清理资源
- `/live2d.config` - 查看配置信息

---

## 故障排查

### 问题 1: 命令无响应
**可能原因**: 适配器未启动或未正确加载

**解决方法**:
1. 使用 `/live2d.status` 检查状态
2. 检查配置文件中 `enable` 是否为 `true`
3. 查看 AstrBot 日志是否有错误信息

### 问题 2: 显示"适配器未找到"
**可能原因**: 插件未正确加载

**解决方法**:
1. 重启 AstrBot
2. 检查插件目录是否完整
3. 查看插件加载日志

### 问题 3: 资源使用率过高
**可能原因**: 资源未及时清理

**解决方法**:
1. 使用 `/live2d.cleanup` 手动清理
2. 调整配置中的 TTL 设置
3. 减小 `resource_max_total_bytes` 配额

---

## 未来计划

以下命令正在开发中，将在未来版本中提供：

- `/live2d.disconnect <client_id>` - 断开指定客户端
- `/live2d.ping <client_id>` - 测试客户端连接
- `/live2d.test_motion <group> [index]` - 测试动作播放
- `/live2d.test_expression <expression_id>` - 测试表情切换
- `/live2d.reload` - 热重载配置
- `/live2d.set <key> <value>` - 动态修改配置
- `/live2d.toggle_streaming` - 切换流式消息
- `/live2d.toggle_tts` - 切换 TTS

---

## 反馈与建议

如果您有任何问题或建议，请访问:
https://github.com/lxfight/astrbot-live2d-adapter/issues
