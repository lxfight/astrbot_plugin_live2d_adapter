# Live2D åŠ¨ä½œç±»å‹ç®¡ç†ç³»ç»Ÿ - å®Œæ•´å®ç°æŒ‡å—

## æ¦‚è¿°

æœ¬ç³»ç»Ÿä¸º AstrBot Live2D é€‚é…å™¨å’Œæ¡Œé¢ç«¯åº”ç”¨æä¾›äº†å®Œæ•´çš„åŠ¨ä½œç±»å‹ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒæ™ºèƒ½åŠ¨ä½œåŒ¹é…ã€æ‹–æ‹½åˆ†é…å’Œéšæœºæ’­æ”¾ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ åŠ¨ä½œç±»å‹ç³»ç»Ÿ

æ”¯æŒ 15 ç§é¢„è®¾åŠ¨ä½œç±»å‹ï¼š
- **åŸºç¡€ç±»å‹**ï¼šå¾…æœºã€è¯´è¯ã€æ€è€ƒã€å¼€å¿ƒã€æƒŠè®¶ã€ç”Ÿæ°”ã€éš¾è¿‡
- **äº¤äº’ç±»å‹**ï¼šè‚¯å®šã€å¦å®šã€ç–‘é—®ã€æ¬¢è¿ã€æ„Ÿè°¢ã€é“æ­‰ã€å‘Šåˆ«ã€å…´å¥‹

æ¯ä¸ªç±»å‹åŒ…å«ï¼š
- å”¯ä¸€æ ‡è¯†ç¬¦å’Œæ˜¾ç¤ºåç§°
- æè¿°æ–‡æœ¬å’Œå›¾æ ‡
- æ™ºèƒ½å…³é”®è¯åŒ¹é…åˆ—è¡¨

### ğŸ¤– æ™ºèƒ½åŒ¹é…ç³»ç»Ÿ

é€‚é…å™¨ç«¯è‡ªåŠ¨æ ¹æ®æ¶ˆæ¯å†…å®¹åŒ¹é…åŠ¨ä½œç±»å‹ï¼š
```python
# ç¤ºä¾‹åŒ¹é…
"ä»Šå¤©å¥½å¼€å¿ƒå•Šï¼" -> "happy"
"è®©æˆ‘æƒ³æƒ³è¿™ä¸ªé—®é¢˜..." -> "thinking" 
"æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ä¸–ç•Œï¼" -> "welcome"
```

### ğŸ­ åŠ¨ä½œç®¡ç†

#### é€‚é…å™¨ç«¯ (astrbot-live2d-adapter)
- `core/motion_types.py` - åŠ¨ä½œç±»å‹å®šä¹‰å’Œæ™ºèƒ½åŒ¹é…
- `converters/output_converter.py` - å¢å¼ºçš„æ¶ˆæ¯è½¬æ¢å™¨
- `commands/test_motion_commands.py` - æµ‹è¯•å‘½ä»¤

#### æ¡Œé¢ç«¯ (astrbot-live2d-desktop)
- `services/motionManagement.ts` - åŠ¨ä½œç®¡ç†æœåŠ¡
- `types/motionManagement.ts` - ç±»å‹å®šä¹‰
- `components/settings/SettingsMotionManagement.vue` - ç®¡ç†ç•Œé¢
- `components/settings/SettingsIdleMotion.vue` - å¾…æœºé…ç½®
- `components/settings/SettingsMotionTest.vue` - æµ‹è¯•ç•Œé¢

## åè®®æ‰©å±•

### è¡¨æ¼”åºåˆ—å¢å¼º
```typescript
interface MotionPerformItem {
  type: 'motion'
  group: string
  index: number
  priority?: number
  loop?: boolean
  fadeIn?: number
  fadeOut?: number
  motionType?: string  // æ–°å¢ï¼šåŠ¨ä½œç±»å‹æ ‡è¯†
}

interface ExpressionPerformItem {
  type: 'expression'
  id?: string
  expressionId?: string
  fade?: number
  motionType?: string  // æ–°å¢ï¼šåŠ¨ä½œç±»å‹æ ‡è¯†
}
```

## ä½¿ç”¨æµç¨‹

### 1. æ¨¡å‹æ‰«æ
æ¡Œé¢ç«¯è‡ªåŠ¨æ‰«æ Live2D æ¨¡å‹æ–‡ä»¶ï¼š
- è§£æ `.model3.json` ä¸­çš„åŠ¨ä½œç»„
- æå–è¡¨æƒ…å®šä¹‰
- ç”ŸæˆåŠ¨ä½œå’Œè¡¨æƒ…åˆ—è¡¨

### 2. åŠ¨ä½œåˆ†é…
é€šè¿‡æ‹–æ‹½ç•Œé¢åˆ†é…åŠ¨ä½œåˆ°ç±»å‹ï¼š
- ä»"æœªåˆ†é…"åŒºåŸŸæ‹–æ‹½åˆ°ç›®æ ‡ç±»å‹
- æ”¯æŒåŒå‡»å¿«é€Ÿåˆ†é…
- å¯è®¾ç½®å¤šä¸ªåŠ¨ä½œä¸ºåŒä¸€ç±»å‹

### 3. å¾…æœºé…ç½®
- è®¾ç½®ä¸“é—¨çš„å¾…æœºåŠ¨ä½œå’Œè¡¨æƒ…
- æ”¯æŒéšæœºå¾…æœºæ’­æ”¾
- å¯é…ç½®ç©ºé—²æ£€æµ‹æ—¶é—´å’Œæ’­æ”¾é—´éš”

### 4. æ™ºèƒ½æ’­æ”¾
é€‚é…å™¨ç«¯æµç¨‹ï¼š
1. æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
2. æ™ºèƒ½åŒ¹é…åŠ¨ä½œç±»å‹
3. ç”Ÿæˆå¸¦ç±»å‹æ ‡è®°çš„è¡¨æ¼”åºåˆ—
4. å‘é€åˆ°æ¡Œé¢ç«¯

æ¡Œé¢ç«¯æµç¨‹ï¼š
1. æ¥æ”¶è¡¨æ¼”åºåˆ—
2. æ ¹æ®åŠ¨ä½œç±»å‹éšæœºé€‰æ‹©å…·ä½“åŠ¨ä½œ
3. å¦‚æœæ— å¯¹åº”ç±»å‹åŠ¨ä½œï¼Œå›é€€åˆ°å¾…æœºåŠ¨ä½œ
4. æ‰§è¡Œæ’­æ”¾

## ç®¡ç†ç•Œé¢åŠŸèƒ½

### SettingsMotionManagement.vue
- âœ… åŠ¨ä½œç±»å‹å¡ç‰‡å±•ç¤º
- âœ… æ‹–æ‹½åˆ†é…åŠŸèƒ½
- âœ… åŠ¨ä½œ/è¡¨æƒ…æ‰«æ
- âœ… é…ç½®å¯¼å…¥/å¯¼å‡º
- âœ… æ‰¹é‡æ¸…ç©ºæ“ä½œ

### SettingsIdleMotion.vue
- âœ… å¾…æœºåŠ¨ä½œç®¡ç†
- âœ… éšæœºåˆ†é…åŠŸèƒ½
- âœ… åŠ¨ä½œä¼˜å…ˆçº§è°ƒæ•´
- âœ… å¾…æœºè®¾ç½®é…ç½®

### SettingsMotionTest.vue
- âœ… åŠ¨ä½œç±»å‹æµ‹è¯•
- âœ… åŒ¹é…åŠŸèƒ½éªŒè¯
- âœ… è¡¨æ¼”åºåˆ—æµ‹è¯•
- âœ… å®æ—¶åŠ¨ä½œæµ‹è¯•
- âœ… å®Œæ•´æµç¨‹æµ‹è¯•

## æµ‹è¯•å‘½ä»¤

### é€‚é…å™¨ç«¯æµ‹è¯•
```bash
# åˆ—å‡ºæ‰€æœ‰åŠ¨ä½œç±»å‹
/test_motion types

# æµ‹è¯•æ–‡æœ¬åŒ¹é…
/test_motion match "ä»Šå¤©çœŸå¼€å¿ƒå•Šï¼"

# æµ‹è¯•å„ç§æƒ…ç»ªåŒ¹é…
/test_motion emotions

# æ¨¡æ‹Ÿæƒ…ç»ªæ¶ˆæ¯
/test_motion simulate å¼€å¿ƒ

# æµ‹è¯•å®Œæ•´æµç¨‹
/test_motion flow

# æ˜¾ç¤ºå¸®åŠ©
/test_motion help
```

### æ¡Œé¢ç«¯æµ‹è¯•
1. æ‰“å¼€è®¾ç½® â†’ åŠ¨ä½œç±»å‹æµ‹è¯•
2. ç‚¹å‡»"å®Œæ•´æµ‹è¯•"æŒ‰é’®
3. æŸ¥çœ‹å„é¡¹æµ‹è¯•ç»“æœ
4. ä½¿ç”¨æƒ…ç»ªæŒ‰é’®æµ‹è¯•å®æ—¶æ’­æ”¾

## é…ç½®æ–‡ä»¶

### å¯¼å‡ºé…ç½®æ ¼å¼
```json
{
  "version": "1.0.0",
  "timestamp": 1641234567890,
  "data": {
    "motionAssignments": {
      "happy": [
        {
          "motionId": "tap_body:0",
          "motionName": "Tap Body",
          "groupId": "tap_body",
          "index": 0,
          "type": { "id": "happy", "name": "å¼€å¿ƒ", ... }
        }
      ]
    },
    "expressionAssignments": {
      "happy": [...]
    },
    "idleMotions": [...],
    "idleExpressions": [...]
  }
}
```

## API æ¥å£

### MotionManagementService ä¸»è¦æ–¹æ³•
```typescript
// åŠ¨ä½œåˆ†é…
assignMotionToType(motion: Live2DMotion, typeId: string): boolean
assignExpressionToType(expression: Live2DExpression, typeId: string): boolean

// åŠ¨ä½œç§»é™¤
removeMotionFromType(motionId: string, typeId: string): boolean
removeExpressionFromType(expressionId: string, typeId: string): boolean

// éšæœºé€‰æ‹©
getRandomMotionForType(typeId: string): MotionAssignment | null
getRandomExpressionForType(typeId: string): MotionAssignment | null
getRandomIdleMotion(): MotionAssignment | null
getRandomIdleExpression(): MotionAssignment | null

// æ¨¡å‹æ‰«æ
scanFromCurrentModel(): Promise<boolean>

// é…ç½®ç®¡ç†
exportConfig(): string
importConfig(configJson: string): boolean
clearAllAssignments(): void
```

## æ™ºèƒ½åŒ¹é…ç®—æ³•

åŸºäºå…³é”®è¯æƒé‡çš„åŒ¹é…ç®—æ³•ï¼š
1. æ–‡æœ¬é¢„å¤„ç†ï¼ˆå°å†™åŒ–ã€åˆ†è¯ï¼‰
2. å…³é”®è¯åŒ¹é…å’Œæƒé‡è®¡ç®—
3. æœ€é«˜åˆ†ç±»å‹é€‰æ‹©
4. é»˜è®¤å›é€€åˆ° 'idle' ç±»å‹

åŒ¹é…ç¤ºä¾‹ï¼š
- `"å¤ªæ£’äº†ï¼æˆ‘éå¸¸å¼€å¿ƒ"` â†’ åŒ¹é…åˆ° "å¼€å¿ƒ"ï¼ˆå…³é”®è¯ï¼šå¼€å¿ƒã€å¤ªæ£’äº†ï¼‰
- `"è®©æˆ‘æƒ³æƒ³è¿™ä¸ªé—®é¢˜"` â†’ åŒ¹é…åˆ° "æ€è€ƒ"ï¼ˆå…³é”®è¯ï¼šæƒ³ã€æ€è€ƒï¼‰
- `"è°¢è°¢å¤§å®¶çš„å¸®åŠ©"` â†’ åŒ¹é…åˆ° "æ„Ÿè°¢"ï¼ˆå…³é”®è¯ï¼šè°¢è°¢ã€æ„Ÿè°¢ï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: åŠ¨ä½œä¸æ’­æ”¾ï¼Ÿ**
A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ¨¡å‹æ˜¯å¦æ­£ç¡®åŠ è½½
2. æ˜¯å¦å·²åˆ†é…åŠ¨ä½œåˆ°å¯¹åº”ç±»å‹
3. æ¡Œé¢ç«¯ä¸é€‚é…å™¨ç«¯è¿æ¥æ˜¯å¦æ­£å¸¸

**Q: åŒ¹é…ä¸å‡†ç¡®ï¼Ÿ**
A: å¯ä»¥ä¼˜åŒ–å…³é”®è¯åˆ—è¡¨ï¼š
- ç¼–è¾‘ `core/motion_types.py` ä¸­çš„å…³é”®è¯
- å¢åŠ æ›´å¤šåŒä¹‰è¯
- è°ƒæ•´åŒ¹é…æƒé‡

**Q: æ‹–æ‹½ä¸å·¥ä½œï¼Ÿ**
A: ç¡®ä¿æµè§ˆå™¨æ”¯æŒï¼š
- ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Firefox/Edgeï¼‰
- æ£€æŸ¥æ‹–æ‹½äº‹ä»¶æ˜¯å¦æ­£ç¡®ç»‘å®š
- éªŒè¯æ•°æ®ä¼ è¾“æ ¼å¼

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```typescript
// æ¡Œé¢ç«¯
localStorage.setItem('debug_motion', 'true')

// é€‚é…å™¨ç«¯
import logging
logging.getLogger().setLevel(logging.DEBUG)
```

## æ€§èƒ½ä¼˜åŒ–

- åŠ¨ä½œåˆ†é…ä¿¡æ¯ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼Œé¿å…é‡å¤è®¡ç®—
- éšæœºé€‰æ‹©ç®—æ³•æ—¶é—´å¤æ‚åº¦ O(1)
- æ‹–æ‹½æ“ä½œä½¿ç”¨è™šæ‹Ÿ DOM ä¼˜åŒ–
- æ¨¡å‹æ‰«æç»“æœç¼“å­˜

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°åŠ¨ä½œç±»å‹
1. åœ¨ `MOTION_TYPES` æ•°ç»„ä¸­æ·»åŠ æ–°ç±»å‹
2. åœ¨é€‚é…å™¨ç«¯å’Œæ¡Œé¢ç«¯åŒæ­¥æ›´æ–°
3. å¢åŠ ç›¸åº”çš„å…³é”®è¯
4. æµ‹è¯•åŒ¹é…å’Œæ’­æ”¾åŠŸèƒ½

### è‡ªå®šä¹‰åŒ¹é…ç®—æ³•
```python
# æ‰©å±• MotionTypeMatcher ç±»
class CustomMotionTypeMatcher(MotionTypeMatcher):
    def match_motion_type(self, text: str) -> str:
        # å®ç°è‡ªå®šä¹‰åŒ¹é…é€»è¾‘
        return super().match_motion_type(text)
```

## ç‰ˆæœ¬å…¼å®¹æ€§

- é€‚é…å™¨ç«¯ï¼šæ”¯æŒ AstrBot v1.0+
- æ¡Œé¢ç«¯ï¼šæ”¯æŒ Electron v12+
- åè®®ç‰ˆæœ¬ï¼šLive2D-Bridge Protocol v1.0

## æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… å®Œæ•´çš„åŠ¨ä½œç±»å‹ç®¡ç†ç³»ç»Ÿ
- âœ… æ™ºèƒ½åŒ¹é…ç®—æ³•
- âœ… æ‹–æ‹½åˆ†é…ç•Œé¢
- âœ… å¾…æœºåŠ¨ä½œé…ç½®
- âœ… æµ‹è¯•å’Œè°ƒè¯•å·¥å…·
- âœ… é…ç½®å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½

---

## æ€»ç»“

æœ¬ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ Live2D åŠ¨ä½œç±»å‹ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œä»æ™ºèƒ½åŒ¹é…åˆ°éšæœºæ’­æ”¾ï¼Œä»ç®¡ç†ç•Œé¢åˆ°æµ‹è¯•å·¥å…·ï¼Œå®ç°äº†ç«¯åˆ°ç«¯çš„è‡ªåŠ¨åŒ–åŠ¨ä½œç®¡ç†ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„æ‹–æ‹½æ“ä½œé…ç½®å¤æ‚çš„åŠ¨ä½œæ’­æ”¾é€»è¾‘ï¼Œå¤§å¤§æå‡äº† Live2D åº”ç”¨çš„äº¤äº’ä½“éªŒã€‚